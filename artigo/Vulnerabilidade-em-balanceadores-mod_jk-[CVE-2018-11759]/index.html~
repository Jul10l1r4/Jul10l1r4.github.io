<!DOCTYPE html>
<html lang="pt-BR">
	<head>
      <meta charset="utf-8"/>
      <title>Vulnerabilidade em balanceadores mod_jk - [CVE-2018-11759] | Julio Lira</title>	
      <!--link rel="icon" type="image/png" href="img/favicon.png" /-->
      <meta name="viewport" content="width=device-width, user-scalable=no"/>
      <link rel="stylesheet" href="https://jul10l1r4.github.io/Texto-farmatacao/principal.css"/>
      <link rel="stylesheet" href="../../css/layout.css"/>
      <meta name="author" content="Julio Lira"/>
			<link rel="icon" href="../../assets/jl.png" />
      <meta name="robots" content="index, follow">
      <meta property="og:site_name" content="https://jul10l1r4.github.io/" />
      <meta property="og:url" content="https://jul10l1r4.github.io/artigo/Vulnerabilidade-em-balanceadores-mod_jk-[CVE-2018-11759]/index.html" />
      <meta name="description" content="O uso de balanceadores (ou load balancer) passou a ser bem maior pela série de benefícios que nos trás, e um dos principais benefícios dele é a segurança."/>
      <meta property="og:title" content="Vulnerabilidade em balanceadores mod_jk - [CVE-2018-11759] | Julio Lira">
      <meta property="og:image" content="https://tomcat.apache.org/connectors-doc-archive/jk2/images/mod_jk.jpg"/>
      <meta property="og:description" content="O uso de balanceadores (ou load balancer) passou a ser bem maior pela série de benefícios que nos trás, e um dos principais benefícios dele é a segurança."/>
      <meta property="og:author" content="Julio Lira"/>
  <!-- twitter metatags-->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Vulnerabilidade em balanceadores mod_jk - [CVE-2018-11759] | Julio Lira">
  <meta name="twitter:description" content="O uso de balanceadores (ou load balancer) passou a ser bem maior pela série de benefícios que nos trás, e um dos principais benefícios dele é a segurança.">
  <meta name="twitter:image" content="https://tomcat.apache.org/connectors-doc-archive/jk2/images/mod_jk.jpg">
			<script src="../../Ecmascript/analiz.js"></script>
			<script async src="../../Ecmascript/scroll.js"></script>
<!-- Facilitar indexação de ferramentas de busca --->
	<script type="application/ld+json">
{
	"name":"Vulnerabilidade em balanceadores mod_jk - [CVE-2018-11759] | Julio Lira",
	"description":"O uso de balanceadores (ou load balancer) passou a ser bem maior pela série de benefícios que nos trás, e um dos principais benefícios dele é a segurança.",
	"author":"Julio Lira",
	"@type":"Organization",
	"url":"https://jul10l1r4.github.io/artigo/Vulnerabilidade-em-balanceadores-mod_jk-[CVE-2018-11759]/index.html",
	"image":"https://instagram.fnat2-1.fna.fbcdn.net/vp/c86b9975b58d82a3e5ea3526131a8d2a/5B146E0F/t51.2885-15/e35/26868816_181404315800705_76975572110016512_n.jpg",
	"headline":"Julio Lira",
  "@context":"http://schema.org",
  "contactPoint": {
					"@type": "ContactPoint",
					"email": "jul10l1r4@ufrn.edu.br"
				}
}
		 </script>
			
    </head>
    <body>
			<header style="background-image: url(../../assets/bg-ops.png)" id="top">
				<div id="to">
			    <h1>Vulnerabilidade em balanceadores mod_jk - [CVE-2018-11759]						<!--img src="https://emojipedia-us.s3.amazonaws.com/thumbs/160/facebook/111/smirking-face_1f60f.png"/-->
				</h1>
				</div>
			</header>
			<a id="down" href="#conteudo">É o apocalipse</a>
			<section class="medium-text">
				<p id="conteudo">
				O uso de balanceadores (ou load balancer) passou a ser bem maior pela série de benefícios que nos trás, e um dos principais benefícios dele é a segurança, tendo um balanceador em uma rede controlará todos os acessos para que sejam centralizados e distribuidos, além de que o servdor mod_jk (módulo do apache) receberá toda a requisição e processará como entende, ou seja: Mesmo que seu outro servidor interno possua falhas de segurança possibilitando um bypass ou até mesmo um arquivo e PHP sem que tenha o interpretador instalado (o mod_jk, impede de que ele seja exibido).	
				</p>
				<p>
				Já um mês atrás o especialista em segurança da infçã<i>o Alphan YAVAS</i> publicou um bug encontrado no código do mod_jk, no qual ele possibilitava ter acesso a rota<code>/jkstatus</code>, onde nela possui todas as informações das instâncias balanceadas, dando a possibilidade de realizar até mesmo algumas configurações relacionadas a ela!
				</p>
				<h1>Descoberta</h1>
				<p>
<<<<<<< HEAD
				O erro era no próprio código fonte do mod_jk especificamente no arquiv<code>tomcat/jk/trunk/native/apache-2.0/mod_jk.c</code>, esse trecho contém a instrução de bloquear com que a ea <code>../</code> seja interpretada como instrução (pois seria possível navegar através dos diretórios), e foi justamente aí que ele encontrou a falha, essa instrução não anularia nenhuma forma de concatenação de requisição, foi realizado o teste injetando justamente essas instruções, reportado como CVE o atuante acrescentou apenas <code>;</code>.
=======
				O erro era no próprio código fonte do mod_jk especificamente no arquivo <code>tomcat/jk/trunk/native/apache-2.0/mod_jk.c</code>, esse trecho contém a instrução de bloquear com que a entrada <code>../</code> seja interpretada como instrução (pois seria possível navegar através dos diretórios), e foi justamente aí que ele encontrou a falha, essa instrução não anularia nenhuma forma de concatenação de requisição, foi realizado o teste injetando justamente essas instruções, reportado como CVE o atuante acrescentou apenas <code>;</code>.
>>>>>>> ea9b477703374a3a569b1edb4f61fbffd1336d56
				</p>
				<h2>Ponto-e-virgula da morte</h2>
				<p>
				Acontece que sinais como: <code>&</code>, <code>;</code> e <code>=</code> são instruções aceitas para envio e recebimento e recebimento de dados HTTP, então tanto o browser entenderá aquilo como uma rota atuante quanto o servidor também compreenderá da mesma forma, uma forma de ver isso em um ambiente real já foi projetada pelo grupo immunIT e está disponível um docker-compose em https://github.com/immunIT/CVE-2018-11759.
				</p>
				<p>
				 O ataque em sua prática é apenas seguir o diretório inicial com <code>/jkstatus&</code>, veja a saída em um teste:
				</p>
				<figure>
					<script src="https://gist.github.com/Jul10l1r4/a6a7354dc1ac893571bc5d5e68f73437.js"></script>
					<figcaption>Requisição normal</figcaption>
				</figure>
				<p>
				 E agora, após alterar a url apenas o ultimo caracter, temos:
				</p>
				<figure>
					<script src="https://gist.github.com/Jul10l1r4/d840c71e1979ac00af270a5e3d82d201.js"></script>
					<figcaption>Ele retorna todo o conteúdo sem ao menos pedir senha</figcaption>
				</figure>
				<h2>Atingidos</h2>
				<p>
				Verifique se sua aplicação está vulnerável a essa exploração, usando esse projeto escrito em shellscript, para usar precisa apenas clonar o repositório e em seguida abrir o arquivo, então já poderá verificar seus ambientes. Para ser mais produtivo você pode usar todos os ambientes com um here-document no script, dessa forma: 
				</p>
				<figure>
					<img src="vuln.jpg" alt="Uso do script de verificação de vulnerabilidade da CVE 2018-11759"/>
					<figcaption>
						Dessa forma, caso você tenha todos os ambientes em uma anotão pode apenas copiar colar e ver o resultado de seus ambientes vulneraveis
					</figcaption>
				</figure>
				<blockquote>
					Caso queira de forma mais interativa é possível apenas abrindo o arquivo.
				</blockquote>
				<p>
				  A versão na qual é possível fazer essa exploração dessa forma é da <code>1.2.0</code> a <code>1.2.44</code>, você está usando essa versão afetada? Uma das formas urgentes de solucionar esse problema é alterar a permissão de leitura do arquivo para que bloqueie aquele acesso, ou que ele requeira um determinado ip para que seja acessado.
				</p>
				<figure>
					<script src="https://gist.github.com/Jul10l1r4/819d0c07c2e8230694262c5e08725cfe.js"></script>
					<figcaption>Dessa forma você pode ter um alívio</figcaption>
				</figure>
				<figure>
					<img src="the-fck-server-is-down.gif" alt="the fuck server is down!"/>
					<figcaption>Corre lá e corrige isso antes que aconteça algo pior!</figcaption>
				</figure>
			</section>
			<footer class="separador-top top6">
       <br/>
				<a href="https://jul10l1r4.github.io/">
					← Ir para a HOME
				</a>
        |
				<a href="http://jul10l1r4.github.io/HTTP_-_Resposta/">
					Mantenha a segurança de sua página, HTTP Meme resposta →
				</a>
			</footer>
    </body>
  </html>		
